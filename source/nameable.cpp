#include "main.h"

BSDATA(namei) = {
	{Human, Male, ""},
	{Dwarf, Male, "Adrik"},
	{Dwarf, Male, "Baern"},
	{Dwarf, Male, "Baerrom"},
	{Dwarf, Male, "Balmur"},
	{Dwarf, Male, "Barendd"},
	{Dwarf, Male, "Beldar"},
	{Dwarf, Male, "Bhalrik"},
	{Dwarf, Male, "Bhelnum"},
	{Dwarf, Male, "Bharthrun"},
	{Dwarf, Male, "Brottor"},
	{Dwarf, Male, "Dain"},
	{Dwarf, Male, "Darrak"},
	{Dwarf, Male, "Delg"},
	{Dwarf, Male, "Durin"},
	{Dwarf, Male, "Eberk"},
	{Dwarf, Male, "Einkil"},
	{Dwarf, Male, "Fargrim"},
	{Dwarf, Male, "Flint"},
	{Dwarf, Male, "Granron"},
	{Dwarf, Male, "Gulkahm"},
	{Dwarf, Male, "Harbek"},
	{Dwarf, Male, "Hormir"},
	{Dwarf, Male, "Kildrak"},
	{Dwarf, Male, "Magmin"},
	{Dwarf, Male, "Morgran"},
	{Dwarf, Male, "Muirrig"},
	{Dwarf, Male, "Orsik"},
	{Dwarf, Male, "Oskar"},
	{Dwarf, Male, "Rangrim"},
	{Dwarf, Male, "Rurik"},
	{Dwarf, Male, "Rusk"},
	{Dwarf, Male, "Taklinn"},
	{Dwarf, Male, "Thoradin"},
	{Dwarf, Male, "Thorin"},
	{Dwarf, Male, "Tordek"},
	{Dwarf, Male, "Travok"},
	{Dwarf, Male, "Ulfgar"},
	{Dwarf, Male, "Vondal"},
	{Dwarf, Female, "Amber"},
	{Dwarf, Female, "Artin"},
	{Dwarf, Female, "Audhild"},
	{Dwarf, Female, "Bardryn"},
	{Dwarf, Female, "Dagnal"},
	{Dwarf, Female, "Diesa"},
	{Dwarf, Female, "Eldeth"},
	{Dwarf, Female, "Falkrunn"},
	{Dwarf, Female, "Finellen"},
	{Dwarf, Female, "Gunnloda"},
	{Dwarf, Female, "Gurdis"},
	{Dwarf, Female, "Helja"},
	{Dwarf, Female, "Hlin"},
	{Dwarf, Female, "Kathra"},
	{Dwarf, Female, "Kristryd"},
	{Dwarf, Female, "Ilde"},
	{Dwarf, Female, "Liftrasa"},
	{Dwarf, Female, "Mardred"},
	{Dwarf, Female, "Riswynn"},
	{Dwarf, Female, "Sannl"},
	{Dwarf, Female, "Torbera"},
	{Dwarf, Female, "Torgga"},
	{Dwarf, Female, "Vistra"},
	{Elf, Male, "Adran"},
	{Elf, Male, "Aelar"},
	{Elf, Male, "Aramil"},
	{Elf, Male, "Arannis"},
	{Elf, Male, "Aust"},
	{Elf, Male, "Beiro"},
	{Elf, Male, "Berrian"},
	{Elf, Male, "Carric"},
	{Elf, Male, "Enialis"},
	{Elf, Male, "Erdan"},
	{Elf, Male, "Erevan"},
	{Elf, Male, "Erevan"},
	{Elf, Male, "Galinndan"},
	{Elf, Male, "Hadarai"},
	{Elf, Male, "Heian"},
	{Elf, Male, "Himo"},
	{Elf, Male, "Immeral"},
	{Elf, Male, "Ivellios"},
	{Elf, Male, "Laucian"},
	{Elf, Male, "Mindartis"},
	{Elf, Male, "Paelias"},
	{Elf, Male, "Peren"},
	{Elf, Male, "Quarion"},
	{Elf, Male, "Riardon"},
	{Elf, Male, "Rolen"},
	{Elf, Male, "Soveliss"},
	{Elf, Male, "Thamior"},
	{Elf, Male, "Tharivol"},
	{Elf, Male, "Theren"},
	{Elf, Male, "Varis"},
	{Elf, Female, "Adrie"},
	{Elf, Female, "Althaea"},
	{Elf, Female, "Anastrianna"},
	{Elf, Female, "Andraste"},
	{Elf, Female, "Antinua"},
	{Elf, Female, "Bethrynna"},
	{Elf, Female, "Birel"},
	{Elf, Female, "Caelynn"},
	{Elf, Female, "Drusilia"},
	{Elf, Female, "Enna"},
	{Elf, Female, "Felosial"},
	{Elf, Female, "Ielenia"},
	{Elf, Female, "Jelenneth"},
	{Elf, Female, "Keyleth"},
	{Elf, Female, "Leshanna"},
	{Elf, Female, "Lia"},
	{Elf, Female, "Meriele"},
	{Elf, Female, "Mialee"},
	{Elf, Female, "Naivara"},
	{Elf, Female, "Quelenna"},
	{Elf, Female, "Quillathe"},
	{Elf, Female, "Sariel"},
	{Elf, Female, "Shanairra"},
	{Elf, Female, "Shava"},
	{Elf, Female, "Silaqui"},
	{Elf, Female, "Theirastra"},
	{Elf, Female, "Thia"},
	{Elf, Female, "Vadania"},
	{Elf, Female, "Valanthe"},
	{Elf, Female, "Xanaphia"},
	{Halfling, Male, "Alton"},
	{Halfling, Male, "Ander"},
	{Halfling, Male, "Cade"},
	{Halfling, Male, "Corrin"},
	{Halfling, Male, "Eldon"},
	{Halfling, Male, "Errich"},
	{Halfling, Male, "Finnan"},
	{Halfling, Male, "Garret"},
	{Halfling, Male, "Lindal"},
	{Halfling, Male, "Lyle"},
	{Halfling, Male, "Merric"},
	{Halfling, Male, "Milo"},
	{Halfling, Male, "Osborn"},
	{Halfling, Male, "Perrin"},
	{Halfling, Male, "Reed"},
	{Halfling, Male, "Roscoe"},
	{Halfling, Male, "Wellby"},
	{Halfling, Female, "Andry"},
	{Halfling, Female, "Bree"},
	{Halfling, Female, "Callie"},
	{Halfling, Female, "Cora"},
	{Halfling, Female, "Euphemia"},
	{Halfling, Female, "Jillian"},
	{Halfling, Female, "Kithri"},
	{Halfling, Female, "Lavinia"},
	{Halfling, Female, "Lidda"},
	{Halfling, Female, "Merla"},
	{Halfling, Female, "Nedda"},
	{Halfling, Female, "Paela"},
	{Halfling, Female, "Portia"},
	{Halfling, Female, "Seraphina"},
	{Halfling, Female, "Shaena"},
	{Halfling, Female, "Trym"},
	{Halfling, Female, "Vani"},
	{Halfling, Female, "Verna"},
	{Human, Male, "Darvin"},
	{Human, Male, "Dorn"},
	{Human, Male, "Evendur"},
	{Human, Male, "Gorstag"},
	{Human, Male, "Grim"},
	{Human, Male, "Helm"},
	{Human, Male, "Malark"},
	{Human, Male, "Morn"},
	{Human, Male, "Randal"},
	{Human, Male, "Stedd"},
	{Human, Male, "Bor"},
	{Human, Male, "Fodel"},
	{Human, Male, "Glar"},
	{Human, Male, "Grigor"},
	{Human, Male, "Igan"},
	{Human, Male, "Ivor"},
	{Human, Male, "Kosef"},
	{Human, Male, "Mival"},
	{Human, Male, "Orel"},
	{Human, Male, "Pavel"},
	{Human, Male, "Sergor"},
	{Human, Male, "Borivik"},
	{Human, Male, "Faurgar"},
	{Human, Male, "Jandar"},
	{Human, Male, "Kanithar"},
	{Human, Male, "Madislak"},
	{Human, Male, "Ralmevik"},
	{Human, Male, "Shaumar"},
	{Human, Male, "Vladislak"},
	{Human, Female, "Arveene"},
	{Human, Female, "Esvele"},
	{Human, Female, "Jhessail"},
	{Human, Female, "Kerri"},
	{Human, Female, "Lureene"},
	{Human, Female, "Miri"},
	{Human, Female, "Rowan"},
	{Human, Female, "Shandri"},
	{Human, Female, "Tessele"},
	{Human, Female, "Alethra"},
	{Human, Female, "Kara"},
	{Human, Female, "Katernin"},
	{Human, Female, "Mara"},
	{Human, Female, "Natali"},
	{Human, Female, "Olma"},
	{Human, Female, "Tana"},
	{Human, Female, "Zora"},
	{Human, Female, "Fyevarra"},
	{Human, Female, "Hulmarra"},
	{Human, Female, "Immith"},
	{Human, Female, "Imzel"},
	{Human, Female, "Navarra"},
	{Human, Female, "Shevarra"},
	{Human, Female, "Tammith"},
	{Human, Female, "Yuldra"},
};

int	gamei::getrandom(race_s race, gender_s gender) {
	const unsigned name_max = sizeof(bsdata<namei>::elements) / sizeof(bsdata<namei>::elements[0]);
	unsigned short data[name_max];
	auto p = data;
	for(unsigned i = 1; i < name_max; i++) {
		if(bsdata<namei>::elements[i].name[0] == 0)
			continue;
		if(bsdata<namei>::elements[i].race != race)
			continue;
		if(bsdata<namei>::elements[i].gender != gender)
			continue;
		*p++ = i;
	}
	auto c = p - data;
	if(!c)
		return 0;
	return data[rand() % c];
}

const char* nameable::getname() const {
	if(kind)
		return bsdata<monsteri>::elements[kind].name;
	return bsdata<namei>::elements[name].name;
}

void nameable::random_name() {
	if(ismonster())
		return;
	auto race = getrace();
	auto gender = getgender();
	if(race == HalfElf) {
		// RULE: Half-elves get names mostly elvish than humans
		if(d100() < 60)
			race = Elf;
		else
			race = Human;
	}
	name = game.getrandom(race, gender);
}

void nameable::kill() {
	game.add(kind);
}

bool nameable::ishero() const {
	return bsdata<creature>::source.indexof(this) != -1;
}

void nameable::say(const char* format, ...) const {
	if(!ishero())
		return;
	sayv(format, xva_start(format));
}

void nameable::say(const item& it, const char* format) const {
	char name[128]; stringbuilder sb(name);
	it.getname(sb);
	say(format, name);
}

void nameable::say(spell_s id) const {
	auto spn = bsdata<spelli>::elements[id].name;
	mslog("%1 cast %2", getname(), spn);
}

void nameable::sayv(const char* format, const char* vl) const {
	char message[1024]; stringbuilder sb(message);
	sb.addv(format, vl);
	mslog("%1 \"%2\"", getname(), message);
}